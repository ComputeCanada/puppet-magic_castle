# for the default cuda/12.6, need at least 560
profile::gpu::install::passthrough::nvidia_driver_stream: '575-dkms'
profile::gpu::install::lib_symlink_path: '/usr/lib64/nvidia'

profile::software_stack::initial_profile: "/cvmfs/soft.computecanada.ca/config/profile/bash.sh"
profile::software_stack::lmod_default_modules:
    - StdEnv/2023
    - jupyterlab-apps/1.0
    - mii

profile::software_stack::extra_site_env_vars:
  CC_CLUSTER: "magic_castle"
  # ensure that packages installed in the local kernel are found, if the same version of python is used in both cases
  EBPYTHONPREFIXES_PRIORITY: "%{alias('jupyterhub::kernel::venv::prefix')}"
lookup_options:
  profile::software_stack::extra_site_env_vars:
    merge: hash

jupyterhub::node::install_method: 'none'
jupyterhub::node::install::prefix: /cvmfs/soft.computecanada.ca/easybuild/software/2023/x86-64-v3/Core/jupyterhub_node/6.8.2

jupyterhub::kernel::install_method: 'venv'
jupyterhub::kernel::venv::python: /cvmfs/soft.computecanada.ca/easybuild/software/2023/%{facts.cpu_microarch}/Compiler/gcccore/python/3.11.5/bin/python
jupyterhub::kernel::venv::prefix: /opt/ipython-kernel-computecanada
jupyterhub::kernel::venv::kernel_name: 'ospython'
jupyterhub::kernel::venv::display_name: 'Python bundle'

lookup_options:
  jupyterhub::kernel::venv::pip_environment:
    merge: "deep"
jupyterhub::kernel::venv::pip_environment:
  PYTHONPATH: ["/cvmfs/soft.computecanada.ca/easybuild/python/site-packages:/cvmfs/soft.computecanada.ca/custom/python/site-packages"]
  PIP_CONFIG_FILE: "/cvmfs/soft.computecanada.ca/config/python/pip-%{facts.cpu_microarch}-gentoo2023.conf"
jupyterhub::kernel::venv::kernel_environment:
  "PYTHONPATH": "/cvmfs/soft.computecanada.ca/easybuild/python/site-packages:${PYTHONPATH}"
  "EBPYTHONPREFIXES": "${SLURM_TMPDIR}:${EBPYTHONPREFIXES}"

jupyterhub::jupyterhub_config_hash:
  SlurmFormSpawner:
    ui_args:
      rstudio:
        modules: ['rstudio-server']
      code-server:
        modules: ['code-server']
      openrefine:
        modules: ['openrefine']

